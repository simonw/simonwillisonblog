<!DOCTYPE html>{% load static %}
<html lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
{% block rel_canonical %}<link rel="canonical" href="https://simonwillison.net{{ request.path }}">{% endblock %}
<title>{% block title %}{% endblock %}</title>
<script defer data-domain="simonwillison.net" src="https://plausible.io/js/plausible.js"></script>
<link rel="alternate" type="application/atom+xml" title="Atom" href="/atom/everything/">
<link rel="stylesheet" type="text/css" href="{% static "css/all.css" %}">
<link rel="webmention" href="https://webmention.io/simonwillison.net/webmention">
<link rel="pingback" href="https://webmention.io/simonwillison.net/xmlrpc">
<meta name="author" content="Simon Willison">
<meta property="og:site_name" content="Simon Willisonâ€™s Weblog">
{% block extrahead %}{% endblock %}
<script>
(function() { // Apply theme immediately to prevent flash
  const theme = localStorage.getItem('theme');
  if (theme === 'light' || theme === 'dark') {
    document.documentElement.setAttribute('data-theme', theme);
  }
})();
</script>
</head>
<body{% block body_class %}{% endblock %}>
{% block body %}{% endblock %}

{% block footer %}
<div id="ft">
    <ul>
      <li><a href="/about/#about-site">Colophon</a></li>
      <li>&copy;</li>{% for year in years_with_content %}
      <li><a href="/{{ year|date:"Y" }}/">{{ year|date:"Y" }}</a></li>{% endfor %}
      <li>
        <button id="theme-toggle" type="button" aria-label="Toggle theme">
          <!-- Auto/System icon (default) -->
          <svg id="icon-auto" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm0-2V4a8 8 0 1 0 0 16z"/></svg>
          <!-- Light icon -->
          <svg id="icon-light" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="display:none"><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"/></svg>
          <!-- Dark icon -->
          <svg id="icon-dark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="display:none"><path d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2h.1A6.979 6.979 0 0 0 10 7zm-6 5a8 8 0 0 0 15.062 3.762A9 9 0 0 1 8.238 4.938 7.999 7.999 0 0 0 4 12z"/></svg>
        </button>
      </li>
    </ul>
</div>
{% endblock %}
<script>
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('h2[id],h3[id],h4[id],h5[id],h6[id]').forEach(el => {
    const id = el.getAttribute('id');
    const permalinkContext = el.closest('[data-permalink-context]');
    if (permalinkContext) {
      const url = permalinkContext.getAttribute('data-permalink-context');
      const hashLink = document.createElement('a');
      hashLink.style.borderBottom = 'none';
      hashLink.style.color = '#666';
      hashLink.style.fontSize = '1em';
      hashLink.style.opacity = 0.8;
      hashLink.setAttribute('href', url + '#' + id);
      hashLink.innerText = '#';
      el.appendChild(document.createTextNode('\u00A0'));
      el.appendChild(hashLink);
    }
  });
});
</script>
<script type="module">
  const config = [
    {"tag": "lite-youtube", "js": "/static/lite-yt-embed.js", "css": "/static/lite-yt-embed.css"}
  ];
  for (const {tag, js, css} of config) {
    if (document.querySelector(tag)) {
      if (css) {
        document.head.appendChild(
          Object.assign(document.createElement('link'), {
            rel: 'stylesheet',
            href: css
          })
        );
      }
      if (js) {
        await import(js);
      }
  }
}
</script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    if (window.localStorage.getItem('ADMIN')) {
      document.querySelectorAll('.edit-page-link').forEach(el => {
        const url = el.getAttribute('data-admin-url');
        if (url) {
          const a = document.createElement('a');
          a.href = url;
          a.innerText = 'Edit this page';
          el.appendChild(a);
          el.style.display = 'block';
        }
      });
    }
  });
</script>
<script>
// Theme toggle functionality
(function() {
  const toggle = document.getElementById('theme-toggle');
  const iconAuto = document.getElementById('icon-auto');
  const iconLight = document.getElementById('icon-light');
  const iconDark = document.getElementById('icon-dark');

  // Theme states: 'auto' (default), 'light', 'dark'
  function getTheme() {
    return localStorage.getItem('theme') || 'auto';
  }

  function setTheme(theme) {
    if (theme === 'auto') {
      localStorage.removeItem('theme');
      document.documentElement.removeAttribute('data-theme');
    } else {
      localStorage.setItem('theme', theme);
      document.documentElement.setAttribute('data-theme', theme);
    }
    updateIcon(theme);
  }

  function updateIcon(theme) {
    iconAuto.style.display = theme === 'auto' ? 'block' : 'none';
    iconLight.style.display = theme === 'light' ? 'block' : 'none';
    iconDark.style.display = theme === 'dark' ? 'block' : 'none';

    // Update aria-label for accessibility
    const labels = {
      'auto': 'Theme: Auto (system preference). Click to switch to light.',
      'light': 'Theme: Light. Click to switch to dark.',
      'dark': 'Theme: Dark. Click to switch to auto.'
    };
    toggle.setAttribute('aria-label', labels[theme]);
  }

  // Cycle through themes: auto -> light -> dark -> auto
  function cycleTheme() {
    const current = getTheme();
    const next = current === 'auto' ? 'light' : current === 'light' ? 'dark' : 'auto';
    setTheme(next);
  }

  // Initialize
  updateIcon(getTheme());
  toggle.addEventListener('click', cycleTheme);
})();
</script>
</body>
</html>
