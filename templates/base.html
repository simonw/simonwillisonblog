<!DOCTYPE html>{% load static %}
<html lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
{% block rel_canonical %}<link rel="canonical" href="https://simonwillison.net{{ request.path }}">{% endblock %}
<title>{% block title %}{% endblock %}</title>
<script defer data-domain="simonwillison.net" src="https://plausible.io/js/plausible.js"></script>
{% if GOOGLE_ANALYTICS_ID %}
<script async src="https://www.googletagmanager.com/gtag/js?id={{ GOOGLE_ANALYTICS_ID }}"></script>
<script>
window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments)}; gtag('js', new Date());gtag('config', '{{ GOOGLE_ANALYTICS_ID }}', {send_page_view: false });
(function() {
    var m = /#atom\-(\w+)/.exec(location.hash);
    if (m) {
        gtag('event', 'page_view', {dimension1: m[1]});
        history.replaceState && history.replaceState(null, '', location.href.split('#')[0]);
    } else {
        gtag('event', 'page_view');
    }
})();
</script>
{% endif %}
<link rel="alternate" type="application/atom+xml" title="Atom" href="/atom/everything/">
<link rel="stylesheet" type="text/css" href="{% static "css/all.css" %}">
<link rel="webmention" href="https://webmention.io/simonwillison.net/webmention">
<link rel="pingback" href="https://webmention.io/simonwillison.net/xmlrpc">
{% block extrahead %}{% endblock %}

</head>
<body{% block body_class %}{% endblock %}>
{% block body %}{% endblock %}

{% block footer %}
<div id="ft">
    <ul>
      <li><a href="https://github.com/simonw/simonwillisonblog">Source code</a></li>
      <li>&copy;</li>{% for year in years_with_content %}
      <li><a href="/{{ year|date:"Y" }}/">{{ year|date:"Y" }}</a></li>{% endfor %}
    </ul>
</div>
{% endblock %}
<script>
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('h4[id],h5[id],h6[id]').forEach(el => {
    const id = el.getAttribute('id');
    const permalinkContext = el.closest('[data-permalink-context]');
    if (permalinkContext) {
      const url = permalinkContext.getAttribute('data-permalink-context');
      const hashLink = document.createElement('a');
      hashLink.style.borderBottom = 'none';
      hashLink.style.color = '#666';
      hashLink.style.fontSize = '1em';
      hashLink.style.opacity = 0.8;
      hashLink.setAttribute('href', url + '#' + id);
      hashLink.innerText = '#';
      el.appendChild(document.createTextNode(' '));
      el.appendChild(hashLink);
    }
  });
});

class TimeDisplay extends HTMLElement {
  // <time-display date="2021-01-01">12:00</time-display>
  constructor() {
    super();
    this.attachShadow({ mode: "open" });
  }
  connectedCallback() {
    // Defer render method to ensure this.innerHTML is available
    setTimeout(() => this.render(), 0);
  }
  render() {
    const date = this.getAttribute("date");
    console.log(this);
    const time = this.innerHTML.trim();
    try {
      const isoString = `${date}T${time}:00Z`;
      const utcDate = new Date(isoString);
      console.log({date, time, 'this': this, isoString});
      const formattedTime = new Intl.DateTimeFormat("en-US", {
        hour: "numeric",
        minute: "numeric",
        hour12: true,
        timeZoneName: "shortGeneric",
      })
        .format(utcDate)
        .replace(/ (AM|PM) /i, (m) => m.slice(1).toLowerCase());
      this.shadowRoot.innerHTML = `<span title="${isoString}">${formattedTime}</span>`;
    } catch (error) {
      console.error("Error parsing date:", error);
      this.shadowRoot.innerHTML = `<span title="Invalid date">${date} ${time} (Invalid)</span>`;
    }
  }
}
customElements.define("time-display", TimeDisplay);
</script>
</body>
</html>
