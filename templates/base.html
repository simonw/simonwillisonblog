<!DOCTYPE html>{% load static %}
<html lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
{% block rel_canonical %}<link rel="canonical" href="https://simonwillison.net{{ request.path }}">{% endblock %}
<title>{% block title %}{% endblock %}</title>
<script defer data-domain="simonwillison.net" src="https://plausible.io/js/plausible.js"></script>
<link rel="alternate" type="application/atom+xml" title="Atom" href="/atom/everything/">
<link rel="stylesheet" type="text/css" href="{% static "css/all.css" %}">
<link rel="webmention" href="https://webmention.io/simonwillison.net/webmention">
<link rel="pingback" href="https://webmention.io/simonwillison.net/xmlrpc">
<meta name="author" content="Simon Willison">
<meta property="og:site_name" content="Simon Willisonâ€™s Weblog">
{% block extrahead %}{% endblock %}
<script>
(function() { // Apply theme immediately to prevent flash
  const theme = localStorage.getItem('theme') || 'auto';
  document.documentElement.setAttribute('data-theme', theme);
})();
</script>
</head>
<body{% block body_class %}{% endblock %}>
{% block body %}{% endblock %}

{% block footer %}
<div id="ft">
    <ul>
      <li><a href="/about/#about-site">Colophon</a></li>
      <li>&copy;</li>{% for year in years_with_content %}
      <li><a href="/{{ year|date:"Y" }}/">{{ year|date:"Y" }}</a></li>{% endfor %}
      <li>
        <button id="theme-toggle" type="button" aria-label="Toggle theme">
          <!-- Auto/System icon (default) -->
          <svg id="icon-auto" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm0-2V4a8 8 0 1 0 0 16z"/></svg>
          <!-- Light icon -->
          <svg id="icon-light" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="display:none"><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"/></svg>
          <!-- Dark icon -->
          <svg id="icon-dark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="display:none"><path d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2h.1A6.979 6.979 0 0 0 10 7zm-6 5a8 8 0 0 0 15.062 3.762A9 9 0 0 1 8.238 4.938 7.999 7.999 0 0 0 4 12z"/></svg>
        </button>
      </li>
    </ul>
</div>
{% endblock %}
<style>image-gallery:not(:defined) img {max-height: 150px;}</style>
<script>
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('h2[id],h3[id],h4[id],h5[id],h6[id]').forEach(el => {
    const id = el.getAttribute('id');
    const permalinkContext = el.closest('[data-permalink-context]');
    if (permalinkContext) {
      const url = permalinkContext.getAttribute('data-permalink-context');
      const hashLink = document.createElement('a');
      hashLink.style.borderBottom = 'none';
      hashLink.style.color = '#666';
      hashLink.style.fontSize = '1em';
      hashLink.style.opacity = 0.8;
      hashLink.setAttribute('href', url + '#' + id);
      hashLink.innerText = '#';
      el.appendChild(document.createTextNode('\u00A0'));
      el.appendChild(hashLink);
    }
  });
});
</script>
<script type="module">
const config = [
  {"tag": "lite-youtube", "js": "/static/lite-yt-embed.js", "css": "/static/lite-yt-embed.css"},
  {"tag": "image-gallery", "js": "/static/image-gallery.js", "css": null}
];
for (const {tag, js, css} of config) {
  if (document.querySelector(tag)) {
    if (css) {
      document.head.appendChild(
        Object.assign(document.createElement('link'), {
          rel: 'stylesheet',
          href: css
        })
      );
    }
    if (js) {
      await import(js);
    }
  }
}
</script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    if (window.localStorage.getItem('ADMIN')) {
      document.querySelectorAll('.edit-page-link').forEach(el => {
        const url = el.getAttribute('data-admin-url');
        if (url) {
          const a = document.createElement('a');
          a.href = url;
          a.className = 'edit-link';
          a.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg> Edit';
          el.appendChild(a);
          el.style.display = 'block';
        }
      });
    }
  });
</script>
<script>
// Random tag navigation - shows button if recently came from tag random
(function() {
  const stored = localStorage.getItem('random_tag');
  if (!stored) return;

  try {
    const data = JSON.parse(stored);
    const elapsed = Date.now() - data.timestamp;

    // Only show if within 5 seconds
    if (elapsed > 5000) return;

    const header = document.getElementById('smallhead-inner');
    if (!header) return;

    const btn = document.createElement('a');
    btn.href = '/random/' + encodeURIComponent(data.tag) + '/';
    btn.className = 'random-tag-nav';
    btn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"></rect><circle cx="8.5" cy="8.5" r="1.5" fill="currentColor" stroke="none"></circle><circle cx="15.5" cy="8.5" r="1.5" fill="currentColor" stroke="none"></circle><circle cx="8.5" cy="15.5" r="1.5" fill="currentColor" stroke="none"></circle><circle cx="15.5" cy="15.5" r="1.5" fill="currentColor" stroke="none"></circle><circle cx="12" cy="12" r="1.5" fill="currentColor" stroke="none"></circle></svg> Random ' + data.tag;

    btn.addEventListener('click', function(e) {
      // Bump the timestamp before navigating
      localStorage.setItem('random_tag', JSON.stringify({
        tag: data.tag,
        timestamp: Date.now()
      }));
    });

    // Insert before the Subscribe link
    const subscribeLink = document.getElementById('smallhead-about');
    if (subscribeLink) {
      header.insertBefore(btn, subscribeLink);
    } else {
      header.appendChild(btn);
    }
  } catch (e) {
    // Invalid JSON, clear it
    localStorage.removeItem('random_tag');
  }
})();
</script>
<script>
// Theme toggle functionality
(function() {
  const toggle = document.getElementById('theme-toggle');
  const iconAuto = document.getElementById('icon-auto');
  const iconLight = document.getElementById('icon-light');
  const iconDark = document.getElementById('icon-dark');

  // Theme states: 'auto' (default), 'light', 'dark'
  function getTheme() {
    return localStorage.getItem('theme') || 'auto';
  }

  function setTheme(theme) {
    localStorage.setItem('theme', theme);
    document.documentElement.setAttribute('data-theme', theme);
    updateIcon(theme);
  }

  function updateIcon(theme) {
    iconAuto.style.display = theme === 'auto' ? 'block' : 'none';
    iconLight.style.display = theme === 'light' ? 'block' : 'none';
    iconDark.style.display = theme === 'dark' ? 'block' : 'none';

    // Update aria-label for accessibility
    const labels = {
      'auto': 'Theme: Auto (system preference). Click to switch to light.',
      'light': 'Theme: Light. Click to switch to dark.',
      'dark': 'Theme: Dark. Click to switch to auto.'
    };
    toggle.setAttribute('aria-label', labels[theme]);
  }

  // Cycle through themes: auto -> light -> dark -> auto
  function cycleTheme() {
    const current = getTheme();
    const next = current === 'auto' ? 'light' : current === 'light' ? 'dark' : 'auto';
    setTheme(next);
  }

  // Initialize
  updateIcon(getTheme());
  toggle.addEventListener('click', cycleTheme);
})();
</script>
</body>
</html>
