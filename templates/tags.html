{% extends "smallhead.html" %}
{% block title %}Tags{% endblock %}
{% block primary %}

<form action="/search/" method="GET">
    <input type="search" class="search-input" name="q" value="" style="width: 80%">
    <input type="submit" class="search-submit" value="Search">
</form>

{% load tag_cloud %}
<p id="tagcloud">{% tag_cloud %}</p>

<script>
(function() {
    const searchInput = document.querySelector('.search-input');
    const tagCloud = document.getElementById('tagcloud');
    const tags = tagCloud.querySelectorAll('.item-tag');

    searchInput.addEventListener('input', function(e) {
        const query = e.target.value.trim().toLowerCase();

        // If search is empty, show all tags
        if (!query) {
            tags.forEach(tag => {
                tag.style.display = '';
            });
            return;
        }

        // Split query on spaces to get individual search terms
        const searchTerms = query.split(/\s+/).filter(term => term.length > 0);

        // Build a regex that matches terms in order with anything in between
        // Escape special regex characters in search terms
        const escapedTerms = searchTerms.map(term =>
            term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')
        );
        const pattern = new RegExp(escapedTerms.join('.*'), 'i');

        // Filter tags
        tags.forEach(tag => {
            const tagText = tag.textContent;

            // Check if tag text matches the pattern (terms in order)
            const matches = pattern.test(tagText);

            tag.style.display = matches ? '' : 'none';
        });
    });
})();
</script>

{% endblock %}

{% block secondary %}
<div class="metabox">
You can view the intersection of up to three tags by navigating to <samp>/tags/tag1+tag2/</samp>.

<h3>Archive by year</h3>
<p>
    {% for year in years_with_content reversed %}
        <a href="/{{ year|date:"Y" }}/">{{ year|date:"Y" }}</a>{% if not forloop.last %} / {% endif %}
    {% endfor %}
</p>
</div>
{% endblock %}

